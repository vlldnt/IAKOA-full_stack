// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["typedSql", "nativeDistinct"]
}

datasource db {
  provider = "postgresql"
}

enum Role {
  USER
  ADMIN
}

enum EventCategory {
  CONCERT
  CINEMA
  THEATRE
  SPECTACLE
  FANFARE
  DANSE
  COURSDEDANSE
  ART
  PEINTURE
  PHOTOGRAPHIE
  EXPOSITION
  MUSEE
  LANCEMENTDELIVRE
  ENFANTS
  JEUX
  JEUXVIDEO
  SOIREEJEUX
  LECTURE
  REPAS
  DEJEUNER
  COURSDECUISINE
  DEGUSTATION
  SOIREE
  BAR
  FESTIVAL
  FETELOCALE
  FERIA
  NATURE
  RANDONNEE
  TRAIL
  OUTDOOR
  MARCHE
  NEIGE
  NAUTISME
  AVENTURE
  YOGA
  MEDITATION
  BIENETRE
  DEVELOPPEMENTPERSONNEL
  CONFERENCE
  FORMATION
  LANGUES
  SALONPROFESSIONNEL
  SCIENCE
  DECOUVERTE
  PATRIMOINE
  VISITE
  ATELIER
  BRICOLAGE
  MODE
  ANIMAUX
  JARDINAGE
  FERME
  BENEVOLAT
  ECOLOGIE
  SOLIDARITE
  RENCONTRE
  EVENEMENTCARITATIF
  ESPORT
  TECHNOLOGIE
  MANGA
  COSPLAY
  TOURNOIJEUXVIDEO
  BROCANTE
  VIDEGRENIER
  ENCHERES
  SPORT
  COMPETITION
  RENCONTRESPORTIVE
  JOURNEE
}

model User {
  id        String   @id @default(uuid()) @db.Uuid
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  name          String         @db.VarChar(30)
  password      String
  email         String         @unique
  role          Role           @default(USER)
  isCreator     Boolean        @default(false)
  refreshToken  String?
  companies     Company[]
  userFavorites UserFavorite[]

  @@index([email])
  @@index([isCreator])
  @@index([role])
  @@map("users")
}

model Company {
  id        String   @id @default(uuid()) @db.Uuid
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  name           String  @db.VarChar(100)
  description    String? @db.VarChar(300)
  website        String?
  socialNetworks Json?   @db.JsonB
  siren          String  @unique @db.Char(9)
  isValidated    Boolean @default(false)
  ownerId        String  @db.Uuid
  owner          User    @relation(fields: [ownerId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  events         Event[]

  @@index([ownerId])
  @@index([siren])
  @@index([isValidated])
  @@map("companies")
}

model Event {
  id        String   @id @default(uuid()) @db.Uuid
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  name          String          @db.VarChar(100)
  date          DateTime        @db.Timestamptz(3)
  description   String          @db.VarChar(5000)
  pricing       Int             @default(0)
  location      Json            @db.JsonB
  companyId     String          @db.Uuid
  website       String?
  categories    EventCategory[]
  company       Company         @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  media         Media[]
  userFavorites UserFavorite[]

  @@index([companyId])
  @@index([date])
  @@index([pricing])
  @@map("events")
}

model Media {
  id        String   @id @default(uuid()) @db.Uuid
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  url     String
  type    String @db.VarChar(50)
  eventId String @db.Uuid
  event   Event  @relation(fields: [eventId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([eventId])
  @@index([type])
  @@map("media")
}

model UserFavorite {
  id        String   @id @default(uuid()) @db.Uuid
  createdAt DateTime @default(now()) @db.Timestamptz(3)

  userId  String @db.Uuid
  eventId String @db.Uuid
  user    User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  event   Event  @relation(fields: [eventId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@unique([userId, eventId])
  @@index([userId])
  @@index([eventId])
  @@map("user_favorites")
}
